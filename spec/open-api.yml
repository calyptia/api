openapi: 3.0.3
info:
  title: Calyptia Cloud API
  version: "1.0"
  description: HTTP API service of Calyptia Cloud
  contact:
    name: Calyptia
    email: hello@calyptia.com
    url: "https://cloud.calyptia.com"
  termsOfService: "https://calyptia.com/terms/"
servers:
  - url: "http://localhost:{port}"
    description: local
    variables:
      port:
        default: "5000"
  - url: "https://cloud-api-dev.calyptia.com"
    description: dev
  - url: "https://cloud-api-prod.calyptia.com"
    description: prod
components:
  securitySchemes:
    user:
      type: http
      scheme: bearer
    project:
      name: X-Project-Token
      type: apiKey
      in: header
  schemas:
    User:
      title: User
      type: object
      description: User model.
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        name:
          type: string
          example: user
        avatarURL:
          type: string
          nullable: true
          format: uri
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - id
        - email
        - name
        - avatarURL
        - createdAt
        - updatedAt
    Project:
      title: Project
      type: object
      description: Project model.
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: my-project
        membersCount:
          type: integer
          minimum: 1
          format: int64
        agentsCount:
          type: integer
          format: int64
          minimum: 0
        aggregatorsCount:
          type: integer
          format: int64
          maximum: 0
        createdAt:
          type: string
          format: date-time
        membership:
          $ref: "#/components/schemas/Membership"
      required:
        - id
        - name
        - membersCount
        - agentsCount
        - aggregatorsCount
        - createdAt
    Token:
      title: Token
      type: object
      properties:
        id:
          type: string
          format: uuid
        token:
          type: string
          example: redacted
        name:
          type: string
          example: my-token
        createdAt:
          type: string
          format: date-time
      required:
        - id
        - token
        - name
        - createdAt
      description: Token model.
    Membership:
      title: Membership
      type: object
      properties:
        id:
          type: string
          format: uuid
        roles:
          type: array
          nullable: true
          uniqueItems: true
          items:
            type: string
            enum:
              - creator
              - admin
        createdAt:
          type: string
          format: date-time
        user:
          $ref: "#/components/schemas/User"
      required:
        - id
        - roles
        - createdAt
      description: Membership of a user in a project.
    Invitation:
      title: Invitation
      type: object
      description: Invitation to a project.
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        createdAt:
          type: string
          format: date-time
      required:
        - id
        - email
        - createdAt
    Agent:
      title: Agent
      type: object
      properties:
        id:
          type: string
          format: uuid
        token:
          type: string
          example: redacted
        name:
          type: string
          example: my-agent
          format: hostname
        machineID:
          type: string
        type:
          type: string
          enum:
            - fluentbit
            - fluentd
        version:
          type: string
          example: v1.8.6
        edition:
          type: string
          enum:
            - community
            - enterprise
        flags:
          type: array
          nullable: true
          uniqueItems: true
          items:
            type: string
        rawConfig:
          type: string
        metadata:
          type: object
          nullable: true
        firstMetricsAddedAt:
          type: string
          format: date-time
        lastMetricsAddedAt:
          type: string
          format: date-time
        metricsCount:
          type: integer
          format: int64
          minimum: 0
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - id
        - token
        - name
        - machineID
        - type
        - version
        - edition
        - flags
        - rawConfig
        - metadata
        - firstMetricsAddedAt
        - lastMetricsAddedAt
        - metricsCount
        - createdAt
        - updatedAt
      description: Agent model.
    AgentConfig:
      title: AgentConfig
      type: object
      description: Agent configuration history entry.
      properties:
        id:
          type: string
          format: uuid
        rawConfig:
          type: string
        createdAt:
          type: string
          format: date-time
      required:
        - id
        - rawConfig
        - createdAt
    Aggregator:
      title: Aggregator
      type: object
      description: Aggregator model.
      properties:
        id:
          type: string
          format: uuid
        token:
          type: string
          example: redacted
        name:
          type: string
          example: my-aggregator
        pipelinesCount:
          type: integer
          format: int64
          minimum: 0
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - id
        - token
        - name
        - pipelinesCount
        - createdAt
        - updatedAt
    ResourceProfile:
      title: ResourceProfile
      type: object
      description: Resource profile model.
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: my-resource-profile
        storageMaxChunksUp:
          type: integer
          format: int32
        storageSyncFull:
          type: boolean
        storageBacklogMemLimit:
          type: string
          example: 1Mi
        storageVolumeSize:
          type: string
          example: 2Mi
        storageMaxChunksPause:
          type: boolean
        cpuBufferWorkers:
          type: integer
          format: int32
        cpuLimit:
          type: string
          example: 3Mi
        cpuRequest:
          type: string
          example: 4Mi
        memoryLimit:
          type: string
          example: 5Mi
        memoryRequest:
          type: string
          example: 6Mi
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - id
        - name
        - storageMaxChunksUp
        - storageSyncFull
        - storageBacklogMemLimit
        - storageVolumeSize
        - storageMaxChunksPause
        - cpuBufferWorkers
        - cpuLimit
        - cpuRequest
        - memoryLimit
        - memoryRequest
        - createdAt
        - updatedAt
    Pipeline:
      title: Pipeline
      type: object
      description: Pipeline model.
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: my-pipeline
        config:
          $ref: "#/components/schemas/PipelineConfig"
        status:
          $ref: "#/components/schemas/PipelineStatus"
        resourceProfile:
          $ref: "#/components/schemas/ResourceProfile"
        replicasCount:
          type: integer
          format: int64
          minimum: 0
        metadata:
          type: object
          nullable: true
          properties:
            nodeSelector:
              type: object
              nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - id
        - name
        - config
        - status
        - resourceProfile
        - replicasCount
        - metadata
        - createdAt
        - updatedAt
    PipelineConfig:
      title: PipelineConfig
      type: object
      description: Pipeline configuration history entry.
      properties:
        id:
          type: string
          format: uuid
        rawConfig:
          type: string
        createdAt:
          type: string
          format: date-time
      required:
        - id
        - rawConfig
        - createdAt
    PipelineStatus:
      title: PipelineStatus
      type: object
      description: Pipeline status history entry.
      properties:
        id:
          type: string
          format: uuid
        config:
          $ref: "#/components/schemas/AgentConfig"
        status:
          type: string
          enum:
            - NEW
            - FAILED
            - STARTING
            - STARTED
            - DELETED
        createdAt:
          type: string
          format: date-time
      required:
        - id
        - config
        - status
        - createdAt
    PipelineFile:
      title: PipelineFile
      type: object
      description: Pipeline file model.
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: myfile
        contents:
          type: string
          format: byte
        encrypted:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - id
        - name
        - contents
        - encrypted
        - createdAt
        - updatedAt
    PipelineSecret:
      title: PipelineSecret
      type: object
      description: Pipeline secret model.
      properties:
        id:
          type: string
          format: uuid
        key:
          type: string
          example: mysecret
        value:
          type: string
          format: byte
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - id
        - key
        - value
        - createdAt
        - updatedAt
    PipelinePort:
      title: PipelinePort
      type: object
      description: Pipeline port model.
      properties:
        id:
          type: string
          format: uuid
        protocol:
          type: string
          example: tcp
        frontendPort:
          type: integer
          format: int32
          minimum: 0
        backendPort:
          type: integer
          format: int32
          minimum: 0
        endpoint:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - id
        - protocol
        - frontendPort
        - backendPort
        - endpoint
        - createdAt
        - updatedAt
    ProjectMetrics:
      title: ProjectMetrics
      type: object
      description: Project metrics model.
      properties:
        measurements:
          type: object
          additionalProperties:
            type: object
            properties:
              totals:
                type: object
                additionalProperties:
                  type: number
                  nullable: true
                  format: float
              plugins:
                type: object
                additionalProperties:
                  $ref: "#/components/schemas/Metrics"
            required:
              - totals
              - plugins
        topPlugins:
          type: object
          additionalProperties:
            type: object
            additionalProperties:
              type: number
              nullable: true
              format: float
      required:
        - measurements
        - topPlugins
    AgentMetrics:
      title: AgentMetrics
      type: object
      description: Agent metrics model.
      properties:
        measurements:
          type: object
          additionalProperties:
            type: object
            properties:
              plugins:
                type: object
                additionalProperties:
                  $ref: "#/components/schemas/Metrics"
              totals:
                type: object
                additionalProperties:
                  type: array
                  items:
                    $ref: "#/components/schemas/MetricFields"
            required:
              - plugins
              - totals
      required:
        - measurements
    Metrics:
      title: Metrics
      type: object
      description: Metrics model.
      properties:
        metrics:
          type: object
          additionalProperties:
            type: array
            items:
              $ref: "#/components/schemas/MetricFields"
      required:
        - metrics
    MetricFields:
      title: MetricFields
      type: object
      description: Metric fields model.
      properties:
        time:
          type: string
          format: date-time
        value:
          type: number
          nullable: true
          format: float
      required:
        - time
        - value
  requestBodies:
    CreateProject:
      content:
        application/json:
          schema:
            type: object
            properties:
              name:
                type: string
                example: new-project
            required:
              - name
      description: Create project request body.
    UpdateProject:
      content:
        application/json:
          schema:
            type: object
            properties:
              name:
                type: string
                example: new-project
                nullable: true
      description: Update project request body.
    CreateToken:
      content:
        application/json:
          schema:
            type: object
            properties:
              name:
                type: string
                example: new-token
            required:
              - name
      description: Create token request body.
    UpdateToken:
      content:
        application/json:
          schema:
            type: object
            properties:
              name:
                type: string
                example: new-token
                nullable: true
      description: Update token request body.
    CreateInvitation:
      content:
        application/json:
          schema:
            type: object
            properties:
              email:
                type: string
                format: email
              redirectURI:
                type: string
                format: uri
            required:
              - email
              - redirectURI
      description: Create invitation request body.
    AcceptInvitation:
      content:
        application/json:
          schema:
            type: object
            properties:
              token:
                type: string
                example: redacted
            required:
              - token
      description: Accept invitation request body.
    RegisterAgent:
      content:
        application/json:
          schema:
            type: object
            properties:
              name:
                type: string
                example: new-agent
                format: hostname
              machineID:
                type: string
              type:
                type: string
                enum:
                  - fluentbit
                  - fluentd
              version:
                type: string
                example: v1.8.6
              edition:
                type: string
                enum:
                  - community
                  - enterprise
              flags:
                type: array
                nullable: true
                items:
                  type: string
              rawConfig:
                type: string
              metadata:
                type: object
                nullable: true
            required:
              - name
              - machineID
              - type
              - version
              - edition
              - flags
              - rawConfig
      description: Register agent request body.
    UpdateAgent:
      content:
        application/json:
          schema:
            type: object
            properties:
              name:
                type: string
                example: new-agent
                format: hostname
                nullable: true
              version:
                type: string
                example: v1.8.6
                nullable: true
              edition:
                type: string
                enum:
                  - community
                  - enterprise
                nullable: true
              flags:
                type: array
                nullable: true
                items:
                  type: string
              rawConfig:
                type: string
                nullable: true
              metadata:
                type: object
                nullable: true
      description: Update agent request body.
    CreateAggregator:
      content:
        application/json:
          schema:
            type: object
            properties:
              name:
                type: string
                example: new-aggregator
              addHealthCheckPipeline:
                type: boolean
              healthCheckPipelinePort:
                type: integer
                format: int32
                minimum: 0
            required:
              - name
              - addHealthCheckPipeline
              - healthCheckPipelinePort
      description: Create aggregator request body.
    UpdateAggregator:
      content:
        application/json:
          schema:
            type: object
            properties:
              name:
                type: string
                example: new-aggregator
                nullable: true
      description: Update aggregator request body.
    CreateResourceProfile:
      content:
        application/json:
          schema:
            type: object
            properties:
              name:
                type: string
                example: my-resource-profile
              storageMaxChunksUp:
                type: integer
                format: int32
              storageSyncFull:
                type: boolean
              storageBacklogMemLimit:
                type: string
                example: 1Mi
              storageVolumeSize:
                type: string
                example: 2Mi
              storageMaxChunksPause:
                type: boolean
              cpuBufferWorkers:
                type: integer
                format: int32
              cpuLimit:
                type: string
                example: 3Mi
              cpuRequest:
                type: string
                example: 4Mi
              memoryLimit:
                type: string
                example: 5Mi
              memoryRequest:
                type: string
                example: 6Mi
            required:
              - name
              - storageMaxChunksUp
              - storageSyncFull
              - storageBacklogMemLimit
              - storageVolumeSize
              - storageMaxChunksPause
              - cpuBufferWorkers
              - cpuLimit
              - cpuRequest
              - memoryLimit
              - memoryRequest
      description: Create resource profile request body.
    UpdateResourceProfile:
      content:
        application/json:
          schema:
            type: object
            properties:
              name:
                type: string
                example: my-resource-profile
                nullable: true
              storageMaxChunksUp:
                type: integer
                format: int32
                nullable: true
              storageSyncFull:
                type: boolean
                nullable: true
              storageBacklogMemLimit:
                type: string
                example: 1Mi
                nullable: true
              storageVolumeSize:
                type: string
                example: 2Mi
                nullable: true
              storageMaxChunksPause:
                type: boolean
                nullable: true
              cpuBufferWorkers:
                type: integer
                format: int32
                nullable: true
              cpuLimit:
                type: string
                example: 3Mi
                nullable: true
              cpuRequest:
                type: string
                example: 4Mi
                nullable: true
              memoryLimit:
                type: string
                example: 5Mi
                nullable: true
              memoryRequest:
                type: string
                example: 6Mi
                nullable: true
      description: Update resource profile request body.
    CreatePipeline:
      content:
        application/json:
          schema:
            type: object
            properties:
              name:
                type: string
                example: new-pipeline
              replicasCount:
                type: integer
                format: int64
                minimum: 0
              rawConfig:
                type: string
              secrets:
                type: array
                nullable: true
                items:
                  type: object
                  properties:
                    key:
                      type: string
                      example: mysecret
                    value:
                      type: string
                      format: byte
                  required:
                    - key
                    - value
              files:
                type: array
                nullable: true
                items:
                  type: object
                  properties:
                    name:
                      type: string
                      example: myfile
                    contents:
                      type: string
                      format: byte
                    encrypted:
                      type: boolean
                  required:
                    - name
                    - contents
                    - encrypted
              resourceProfile:
                type: string
                example: my-resource-profile
              autoCreatePortsFromConfig:
                type: boolean
              metadata:
                type: object
                nullable: true
                properties:
                  nodeSelector:
                    type: object
                    nullable: true
            required:
              - name
              - replicasCount
              - rawConfig
              - secrets
              - files
              - resourceProfile
              - autoCreatePortsFromConfig
      description: Create pipeline request body.
    UpdatePipeline:
      content:
        application/json:
          schema:
            type: object
            properties:
              name:
                type: string
                example: new-pipeline
                nullable: true
              replicasCount:
                type: integer
                format: int64
                nullable: true
              rawConfig:
                type: string
                nullable: true
              secrets:
                type: array
                nullable: true
                items:
                  type: object
                  properties:
                    key:
                      type: string
                      example: mysecret
                      nullable: true
                    value:
                      type: string
                      format: byte
                      nullable: true
              files:
                type: array
                nullable: true
                items:
                  type: object
                  properties:
                    name:
                      type: string
                      example: myfile
                      nullable: true
                    contents:
                      type: string
                      format: byte
                      nullable: true
                    encrypted:
                      type: boolean
                      nullable: true
              resourceProfile:
                type: string
                example: my-resource-profile
                nullable: true
              autoCreatePortsFromConfig:
                type: boolean
                nullable: true
              metadata:
                type: object
                nullable: true
                properties:
                  nodeSelector:
                    type: object
                    nullable: true
      description: Update pipeline request body.
    CreatePipelineFile:
      content:
        application/json:
          schema:
            type: object
            properties:
              name:
                type: string
                example: newfile
              contents:
                type: string
                format: byte
              encrypted:
                type: boolean
            required:
              - name
              - contents
              - encrypted
      description: Create pipeline file request body.
    UpdatePipelineFile:
      content:
        application/json:
          schema:
            type: object
            properties:
              name:
                type: string
                example: newfile
                nullable: true
              contents:
                type: string
                format: byte
                nullable: true
              encrypted:
                type: boolean
                nullable: true
      description: Update pipeline file request body.
    CreatePipelineSecret:
      content:
        application/json:
          schema:
            type: object
            properties:
              key:
                type: string
                example: newsecret
              value:
                type: string
                format: byte
            required:
              - key
              - value
      description: Create pipeline secret request body.
    UpdatePipelineSecret:
      content:
        application/json:
          schema:
            type: object
            properties:
              key:
                type: string
                example: newsecret
                nullable: true
              value:
                type: string
                format: byte
                nullable: true
      description: Update pipeline secret request body.
    CreatePipelinePort:
      content:
        application/json:
          schema:
            type: object
            properties:
              protocol:
                type: string
                example: tcp
              frontendPort:
                type: integer
                format: int32
                minimum: 0
              backendPort:
                type: integer
                format: int32
                minimum: 0
              endpoint:
                type: string
            required:
              - protocol
              - frontendPort
              - backendPort
              - endpoint
      description: Create pipeline port request body.
    UpdatePipelinePort:
      content:
        application/json:
          schema:
            type: object
            properties:
              protocol:
                type: string
                example: tcp
                nullable: true
              frontendPort:
                type: integer
                format: int32
                nullable: true
              backendPort:
                type: integer
                format: int32
                nullable: true
              endpoint:
                type: string
                nullable: true
      description: Update pipeline port request body.
paths: {}
